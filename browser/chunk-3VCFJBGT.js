import{a as w}from"./chunk-2QDW4DQJ.js";import{a as x,b as m,c as k,d as N,f as c,h as D,i as U,j as I,k as j,n as L,p as P}from"./chunk-GMB2OH5J.js";import{a as V}from"./chunk-IWK7SOX5.js";import{a as E}from"./chunk-F4SQSF7Y.js";import{c as y}from"./chunk-EPYS6DY5.js";import"./chunk-X4BA4ZY7.js";import"./chunk-VHIVGA7J.js";import{k as S,p as _}from"./chunk-JTZO6T7H.js";import{Db as o,Fb as C,Lb as h,Na as a,Sa as v,Xa as F,d as T,hb as s,ob as r,pb as i,qb as l,vb as b}from"./chunk-NWJZ2U3V.js";var p=T(V());var f=d=>({"form-control with-light":!0,error:d}),R=(()=>{class d{constructor(e,n,t,u){this.fb=e,this._service=n,this._user=t,this._router=u,this.image=null,this.idUser=null,this.dangerLevel="Unknown",this.idUser=this._user.getUserIdFromToken();let g={name:new c("",[m.required]),location:new c("",[m.required]),salary:new c("",[m.required]),description:new c("",[m.required]),crackWidth:new c("",[m.required,m.min(0)])};this.postForm=e.group(g),this.postForm.get("crackWidth")?.valueChanges.subscribe(B=>{this.dangerLevel=this.classifyCrack(B)})}classifyCrack(e){return e<3?"Low Danger \u{1F7E2}":3<=e&&e<25?"Medium Danger \u{1F7E1}":"High Danger \u{1F534}"}selectImage(e){this.image=e.target.files[0]}create(){if(!this.postForm.valid){p.default.fire({position:"top-end",icon:"error",title:"Please correct the errors in the form.",text:this.getFormValidationErrors(),showConfirmButton:!1,timer:3e3});return}if(!this.image){p.default.fire({position:"top-end",icon:"error",title:"Please select an image",showConfirmButton:!1,timer:1500});return}if(!this.idUser){p.default.fire({position:"top-end",icon:"error",title:"User not logged in",showConfirmButton:!1,timer:1500});return}let e=new FormData;e.append("name",this.postForm.value.name),e.append("location",this.postForm.value.location),e.append("salary",this.postForm.value.salary),e.append("description",this.postForm.value.description),e.append("crackWidth",this.postForm.value.crackWidth),e.append("dangerLevel",this.dangerLevel),e.append("image",this.image),e.append("idUser",this.idUser),this._service.create(e).subscribe({next:n=>{p.default.fire({position:"top-end",icon:"success",title:"Your post has been saved",showConfirmButton:!1,timer:1500}),this._router.navigate(["/client/my-services"])},error:n=>{p.default.fire({position:"top-end",icon:"error",title:"Error saving post",showConfirmButton:!1,timer:1500}),console.error("Error saving post",n)}})}getFormValidationErrors(){let e=[];return Object.keys(this.postForm.controls).forEach(n=>{let t=this.postForm.get(n)?.errors;t&&Object.keys(t).forEach(u=>{e.push(`${n} is ${u}`)})}),e.join(", ")}static{this.\u0275fac=function(n){return new(n||d)(v(L),v(w),v(E),v(y))}}static{this.\u0275cmp=F({type:d,selectors:[["app-post"]],decls:63,vars:15,consts:[[1,"row"],[1,"col-lg-12","col-md-12","col-sm-12"],[1,"bredcrumb_wrap"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","#"],["aria-current","page",1,"breadcrumb-item","active"],[1,"_dashboard_content"],[1,"_dashboard_content_header"],[1,"_dashboard__header_flex"],[1,"ti-briefcase","mr-1"],[1,"_dashboard_content_body"],[3,"ngSubmit","formGroup"],[1,"col-xl-4","col-lg-6"],[1,"form-group"],["type","text","formControlName","name",3,"ngClass"],[1,"form-group","with-light"],["type","number","formControlName","crackWidth",1,"form-control"],["type","text","formControlName","location",3,"ngClass"],[1,"col-xl-6","col-lg-6"],[1,"form-row"],[1,"col-xl-6","col-lg-6","col-md-6"],[1,"input-group","mb-3"],["type","text","formControlName","salary",3,"ngClass"],[1,"input-group-append"],[1,"input-group-text","light"],[1,"col-xl-12","col-lg-12"],["formControlName","description",3,"ngClass"],["type","file",1,"form-control","with-light",3,"change"],["type","submit",1,"btn","btn-save",3,"disabled"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"nav",3)(4,"ol",4)(5,"li",5)(6,"a",6),o(7,"Home"),i()(),r(8,"li",5)(9,"a",6),o(10,"Dashboard"),i()(),r(11,"li",7),o(12,"Post Task"),i()()()()()(),r(13,"div",0)(14,"div",1)(15,"div",8)(16,"div",9)(17,"div",10)(18,"h4"),l(19,"i",11),o(20,"Submit Task Form"),i()()(),r(21,"div",12)(22,"form",13),b("ngSubmit",function(){return t.create()}),r(23,"div",0)(24,"div",14)(25,"div",15)(26,"label"),o(27,"Project Name"),i(),l(28,"input",16),i()(),r(29,"div",14)(30,"div",17)(31,"label"),o(32,"Crack Width (mm)"),i(),l(33,"input",18),r(34,"div"),o(35),i()()(),r(36,"div",14)(37,"div",15)(38,"label"),o(39,"Location"),i(),l(40,"input",19),i()(),r(41,"div",20)(42,"label"),o(43,"Salary"),i(),r(44,"div",21)(45,"div",22)(46,"div",23),l(47,"input",24),r(48,"div",25)(49,"span",26),o(50,"USD"),i()()()()()(),r(51,"div",27)(52,"div",15)(53,"label"),o(54,"Job Description"),i(),l(55,"textarea",28),i()(),r(56,"div",27)(57,"div",15)(58,"label"),o(59,"Image"),i(),r(60,"input",29),b("change",function(g){return t.selectImage(g)}),i()()(),r(61,"button",30),o(62,"Submit Job"),i()()()()()()()),n&2&&(a(22),s("formGroup",t.postForm),a(6),s("ngClass",h(7,f,t.postForm.controls.name.touched&&t.postForm.controls.name.invalid)),a(7),C("Danger Level: ",t.dangerLevel,""),a(5),s("ngClass",h(9,f,t.postForm.controls.location.touched&&t.postForm.controls.location.invalid)),a(7),s("ngClass",h(11,f,t.postForm.controls.salary.touched&&t.postForm.controls.salary.invalid)),a(8),s("ngClass",h(13,f,t.postForm.controls.description.touched&&t.postForm.controls.description.invalid)),a(6),s("disabled",t.postForm.invalid))},dependencies:[_,S,P,D,x,U,k,N,I,j],encapsulation:2})}}return d})();export{R as PostComponent};
