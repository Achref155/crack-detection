import{a as y,b as u,c as I,d as E,f as c,h as N,j as L,k as P,n as _,p as k}from"./chunk-GMB2OH5J.js";import{a as A}from"./chunk-IWK7SOX5.js";import{a as b}from"./chunk-F4SQSF7Y.js";import{c as S,d as F,f as w}from"./chunk-EPYS6DY5.js";import"./chunk-X4BA4ZY7.js";import"./chunk-VHIVGA7J.js";import{k as h,p as C}from"./chunk-JTZO6T7H.js";import{Db as n,Lb as g,Na as s,Sa as m,Xa as f,d as M,hb as a,ob as t,pb as r,qb as d,vb as v}from"./chunk-NWJZ2U3V.js";var p=M(A());var D=l=>({"form-control":!0,error:l}),H=(()=>{class l{constructor(i,e,o){this.fb=i,this._user=e,this.router=o,this.loginInProgress=!1,this.loginForm=i.group({email:new c("",[u.required,u.email]),password:new c("",[u.required])})}login(){if(this.loginInProgress)return;if(this.loginForm.invalid){p.default.fire({position:"top-end",icon:"error",title:"Please fill in all required fields",showConfirmButton:!1,timer:1500});return}this.loginInProgress=!0;let i=this.loginForm.value;i.email=i.email.trim(),i.password=i.password.trim(),console.log("Login payload:",i),this._user.login(i).subscribe({next:e=>{this.loginInProgress=!1,e.token&&e.user?(localStorage.setItem("token",e.token),localStorage.setItem("user",JSON.stringify(e.user)),console.log("Stored user data:",e.user),e.user.role==="admin"?this.router.navigate(["/admin"]):this.router.navigate(["/client"])):p.default.fire({position:"top-end",icon:"error",title:"Invalid response from server",showConfirmButton:!1,timer:1500})},error:e=>{this.loginInProgress=!1,console.error("Login Error Details:",e);let o=e.error?.message||"Authentication failed";p.default.fire({position:"top-end",icon:"error",title:o,showConfirmButton:!1,timer:1500})}})}static{this.\u0275fac=function(e){return new(e||l)(m(_),m(b),m(S))}}static{this.\u0275cmp=f({type:l,selectors:[["app-login"]],decls:25,vars:8,consts:[["role","document",1,"modal-dialog","modal-dialog-centered","login-pop-form"],["id","registermodal",1,"modal-content"],[1,"modal-header"],[1,"modal-body"],[1,"login-form"],[3,"ngSubmit","formGroup"],[1,"form-group"],["type","text","formControlName","email",1,"form-control",3,"ngClass"],["type","password","formControlName","password",3,"ngClass"],["type","submit",1,"btn","dark-2","btn-md","full-width","pop-login",3,"disabled"],[1,"modal-footer"],[1,"mf-link"],[1,"ti-user"],["routerLink","/register",1,"theme-cl"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),n(4,"Sign In"),r()(),t(5,"div",3)(6,"div",4)(7,"form",5),v("ngSubmit",function(){return o.login()}),t(8,"div",6)(9,"label"),n(10,"E-mail"),r(),d(11,"input",7),r(),t(12,"div",6)(13,"label"),n(14,"Password"),r(),d(15,"input",8),r(),t(16,"div",6)(17,"button",9),n(18,"Login"),r()()()()(),t(19,"div",10)(20,"div",11),d(21,"i",12),n(22,"Haven't An Account?"),t(23,"a",13),n(24,"Sign Up"),r()()()()()),e&2&&(s(7),a("formGroup",o.loginForm),s(4),a("ngClass",g(4,D,o.loginForm.controls.email.touched&&o.loginForm.controls.email.invalid)),s(4),a("ngClass",g(6,D,o.loginForm.controls.password.touched&&o.loginForm.controls.password.invalid)),s(2),a("disabled",o.loginForm.invalid||o.loginInProgress))},dependencies:[w,F,k,N,y,I,E,L,P,C,h],encapsulation:2})}}return l})();export{H as LoginComponent};
